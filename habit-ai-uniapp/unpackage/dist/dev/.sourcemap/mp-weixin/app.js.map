{"version":3,"file":"app.js","sources":["App.vue"],"sourcesContent":["<script>\r\nimport * as utils_storage from \"./utils/storage.js\";\r\nimport { apiService } from \"./utils/api.js\";  // Add this import\r\n\r\nexport default {\r\n  onLaunch() {\r\n    console.log(\"App Launch\");\r\n    this.autoLogin();\r\n    // this.checkAndRestoreData();\r\n    // utils_storage.checkAutoBackup();\r\n  },\r\n  onShow() {\r\n    console.log(\"App Show\");\r\n  },\r\n  onHide() {\r\n    console.log(\"App Hide\");\r\n    // utils_storage.checkAutoBackup();\r\n  },\r\n  methods: {\r\n    async autoLogin() {\r\n      try {\r\n        const telephone = uni.getStorageSync('telephone');\r\n        const password = uni.getStorageSync('password');\r\n        \r\n        if (telephone && password) {\r\n          const loginRes = await apiService.login({\r\n            telephone,\r\n            password\r\n          });\r\n          \r\n          if (loginRes.status === 'success') {\r\n            // Set token\r\n            uni.setStorageSync('token', loginRes.token);\r\n            \r\n            // Get user info\r\n            const userInfo = await apiService.getUserInfo();\r\n            if (userInfo.status === 'success') {\r\n              uni.setStorageSync('userInfo', userInfo.data);\r\n            }\r\n            \r\n            // Get habit list\r\n            const habitList = await apiService.getHabitList();\r\n            if (habitList.status === 'success') {\r\n              const processedHabits = habitList.data.map(habit => ({\r\n                ...habit,\r\n                icon: habit.icon || \"✨\",\r\n                color: habit.color || '$theme-color',\r\n                completed: Array.isArray(habit.completed) \r\n                  ? habit.completed.map(dateStr => {\r\n                      const date = dateStr.includes('T') \r\n                        ? new Date(dateStr)\r\n                        : new Date(dateStr.replace(/(\\d{4})-(\\d{2})-(\\d{2})/, '$1/$2/$3'));\r\n                      return date.toISOString();\r\n                  })\r\n                  : []\r\n              }));\r\n              uni.setStorageSync('habits', processedHabits);\r\n            }\r\n            \r\n            // Get AI characters\r\n            const response = await apiService.getAICharacterList();\r\n            if (response.status === 'success') {\r\n              uni.setStorageSync('aiCharacters', response.data);\r\n            }\r\n            \r\n            console.log('Auto login successful');\r\n            uni.reLaunch({\r\n              url: '/pages/index/index'\r\n            });\r\n          } else {\r\n            this.clearLoginData();\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Auto login failed:', error);\r\n        this.clearLoginData();\r\n      }\r\n    },\r\n\r\n    clearLoginData() {\r\n      uni.removeStorageSync('token');\r\n      uni.removeStorageSync('loginExpireTime');\r\n      uni.removeStorageSync('userInfo');\r\n      uni.removeStorageSync('habits');\r\n      uni.removeStorageSync('aiCharacters');\r\n    },\r\n\r\n    async checkAndRestoreData() {\r\n      const habits = uni.getStorageSync(\"habits\");\r\n      if (!habits || habits.length === 0) {\r\n        const backupInfo = utils_storage.checkBackupAvailable();\r\n        if (backupInfo.available) {\r\n          uni.showModal({\r\n            title: \"发现数据备份\",\r\n            content: \"检测到您有可用的数据备份，是否恢复？\",\r\n            success: (res) => {\r\n              if (res.confirm) {\r\n                const result = utils_storage.restoreFromBackup();\r\n                if (result.success) {\r\n                  uni.showToast({\r\n                    title: \"数据恢复成功\",\r\n                    icon: \"success\"\r\n                  });\r\n                } else {\r\n                  uni.showToast({\r\n                    title: \"数据恢复失败\",\r\n                    icon: \"none\"\r\n                  });\r\n                }\r\n              }\r\n            }\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.container, page {\r\n    background-color: #fff;\r\n}\r\n\r\n.container {\r\n    min-height: 100vh;\r\n}\r\n\r\npage {\r\n    --theme-color: #00c988;\r\n    --theme-color-light: #fff;\r\n    --status-bar-height: 25px;\r\n    --top-window-height: 0px;\r\n    --window-top: 0px;\r\n    --window-bottom: 0px;\r\n    --window-left: 0px;\r\n    --window-right: 0px;\r\n    --window-magin: 0px;\r\n}\r\n\r\n[data-c-h=\"true\"] {\r\n    display: none!important;\r\n}\r\n</style>"],"names":["uni","apiService","utils_storage.checkBackupAvailable","utils_storage.restoreFromBackup"],"mappings":"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"}