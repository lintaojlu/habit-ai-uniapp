{"version":3,"file":"settings.js","sources":["pages/settings/settings.vue","pages/settings/settings.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 用户信息区域 -->\n    <view class=\"settings-card user-info-section\">\n      <view class=\"avatar-wrapper\">\n        <image class=\"avatar\" :src=\"userInfo.avatar_url || 'https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0'\" mode=\"aspectFill\"/>\n      </view>\n      <view class=\"user-info\">\n        <text class=\"nickname\">{{ userInfo.nickname }}</text>\n      </view>\n    </view>\n\n    <!-- AI设置区域 -->\n    <view class=\"settings-card setting-item\">\n      <view class=\"setting-left\">\n        <text class=\"setting-icon\">🤖</text>\n        <text class=\"setting-label\">角色设置</text>\n      </view>\n      <picker \n        ref=\"rolePicker\"\n        class=\"role-picker\" \n        :value=\"selectedRoleIndex\" \n        :range=\"ai_character_names\" \n        @change=\"onRoleChange\"\n      >\n        <view class=\"picker-value\">\n          {{ currentCharacterName }}\n          <text class=\"arrow\">></text>\n        </view>\n      </picker>\n    </view>\n\n    <!-- 隐私设置 -->\n    <view class=\"settings-card setting-item\" @tap=\"onPrivacy\">\n      <view class=\"setting-left\">\n        <text class=\"setting-icon\">🔒</text>\n        <text class=\"setting-label\">隐私设置</text>\n      </view>\n      <text class=\"arrow\">></text>\n    </view>\n\n    <!-- 用户反馈区域 -->\n    <view class=\"settings-card setting-item\" @tap=\"onFeedback\">\n      <view class=\"setting-left\">\n        <text class=\"setting-icon\">📢</text>\n        <text class=\"setting-label\">意见反馈</text>\n      </view>\n      <text class=\"arrow\">></text>\n    </view>\n\n    <!-- 退出登录按钮 -->\n    <view class=\"settings-card setting-item\" @tap=\"onLogout\">\n      <view class=\"setting-left\">\n        <text class=\"setting-icon\">🚪</text>\n        <text class=\"setting-label logout\">退出登录</text>\n      </view>\n      <text class=\"arrow\">></text>\n    </view>\n\n    <!-- 添加二维码卡片组件 -->\n    <view class=\"qr-card-container\" v-if=\"showQrCard\" @tap=\"closeQrCard\">\n      <view class=\"qr-card\" \n        :class=\"[\n          showQrCard && 'slide-in',\n          isClosingDown && 'slide-out-down',\n          isDragging && 'dragging'\n        ]\" \n        :style=\"dragStyle\"\n        @tap.stop\n        @touchstart=\"handleTouchStart\"\n        @touchmove=\"handleTouchMove\"\n        @touchend=\"handleTouchEnd\"\n      >\n        <view class=\"qr-date\">{{ formattedDate }}</view>\n        <view class=\"qr-content\">\n          <text class=\"qr-title\">加入内测群</text>\n          <image class=\"qr-image\" src=\"/static/group_qr.png\" mode=\"aspectFit\"></image>\n          <text class=\"qr-desc\">扫描二维码加入内测群\\n一起交流使用心得</text>\n        </view>\n        <view class=\"swipe-hint\">\n          <text class=\"hint-text\">下滑关闭</text>\n          <text class=\"arrow-icon\">↓</text>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { apiService } from '@/utils/api.js'  // 添加导入\n\nexport default {\n  data() {\n    return {\n      userInfo: {\n        user_id: '',\n        nickname: '',\n        avatar_url: '',\n        ai_character_name: '',\n        telephone: '',\n      },\n      aiCharacters: [], // AI角色列表\n      selectedRoleIndex: 0,  // 添加逗号\n      showQrCard: false,      // 添加 showQrCard\n      isClosingDown: false,\n      isDragging: false,\n      startY: 0,\n      currentY: 0\n    }\n  },\n\n  computed: {\n    ai_character_names() {\n      return this.aiCharacters.map(char => char.name)\n    },\n    currentCharacterName() {\n      if (this.aiCharacters.length === 0) return '加载中...'\n      return this.aiCharacters[this.selectedRoleIndex]?.name || '请选择角色'\n    },\n    // 添加 formattedDate 计算属性\n    formattedDate() {\n      const now = new Date()\n      const month = now.getMonth() + 1\n      const date = now.getDate()\n      const weekDays = ['周日', '周一', '周二', '周三', '周四', '周五', '周六']\n      const weekDay = weekDays[now.getDay()]\n      return `${month}月${date}日 ${weekDay}`\n    }\n  },\n\n  onLoad() {\n    this.loadUserInfo()\n    this.loadAICharacters()\n  },\n\n  methods: {\n    loadUserInfo() {\n      const userInfo = uni.getStorageSync('userInfo')\n      if (userInfo) {\n        this.userInfo = userInfo\n      }\n    },\n\n    async loadAICharacters() {\n      try {\n        // 先从本地获取角色列表\n        const characters = uni.getStorageSync('aiCharacters')\n        if (characters) {\n          this.aiCharacters = characters\n          \n          // 如果用户有设置角色，找到对应的索引\n          if (this.userInfo.ai_character_name) {\n            const currentIndex = this.aiCharacters.findIndex(\n              char => char.name === this.userInfo.ai_character_name\n            )\n            if (currentIndex !== -1) {\n              this.selectedRoleIndex = currentIndex\n            }\n          }\n        } else {\n          // 如果本地没有角色列表，从服务器获取\n          const response = await apiService.getAICharacterList()\n          if (response.status === 'success') {\n            this.aiCharacters = response.data\n            uni.setStorageSync('aiCharacters', response.data)\n            \n            // 设置当前选中的角色索引\n            if (this.userInfo.ai_character_name) {\n              const currentIndex = this.aiCharacters.findIndex(\n                char => char.name === this.userInfo.ai_character_name\n              )\n              if (currentIndex !== -1) {\n                this.selectedRoleIndex = currentIndex\n              }\n            }\n          }\n        }\n      } catch (error) {\n        console.error('加载AI角色失败:', error)\n        uni.showToast({\n          title: '加载角色失败',\n          icon: 'none'\n        })\n      } finally {\n        uni.hideLoading()\n      }\n    },\n\n    onPrivacy() {\n      uni.showToast({\n        title: '功能开发中',\n        icon: 'none'\n      })\n    },\n\n    onFeedback() {\n      this.showQrCard = true\n    },\n\n    onLogout() {\n      uni.showModal({\n        title: '提示',\n        content: '确定要退出登录吗？',\n        success: (res) => {\n          if (res.confirm) {\n            // 清除本地存储的用户信息\n            uni.removeStorageSync('userInfo')\n            uni.removeStorageSync('token')\n            uni.removeStorageSync('habits')\n            uni.removeStorageSync('aiCharacters')\n            uni.clearStorageSync()\n\n            // 重定向到登录页\n            uni.reLaunch({\n              url: '/pages/login/login'\n            })\n          }\n        }\n      })\n    },\n\n    handleTouchStart(e) {\n      this.startY = e.touches[0].clientY\n      this.isDragging = true\n      e.stopPropagation()\n    },\n\n    handleTouchMove(e) {\n      if (!this.isDragging) return\n      this.currentY = e.touches[0].clientY\n      e.preventDefault()\n      e.stopPropagation()\n    },\n\n    handleTouchEnd(e) {\n      if (!this.isDragging) return\n      const dragDistance = this.currentY - this.startY\n      if (dragDistance > 100) {\n        this.closeQrCard()\n      }\n      this.isDragging = false\n      this.startY = 0\n      this.currentY = 0\n      e.stopPropagation()\n    },\n\n    closeQrCard() {\n      this.isClosingDown = true\n      setTimeout(() => {\n        this.showQrCard = false\n        this.isClosingDown = false\n      }, 500)\n    }\n  }\n}\n</script>\n\n<style>\n.container {\n  padding: 30rpx;\n  background: #f5f7fa;\n  min-height: 100vh;\n}\n\n.settings-section {\n  background: #f5f7fa;\n}\n\n.settings-card {\n  background: #fff;\n  border-radius: 20rpx;\n  padding: 30rpx;\n  margin-bottom: 20rpx;\n}\n\n.user-info-section {\n  background: var(--theme-color);\n  display: flex;\n  align-items: center;\n  padding: 40rpx;\n  height: 200rpx;\n  border-radius: 20rpx;\n  margin-bottom: 20rpx;\n}\n\n.avatar-wrapper {\n  width: 120rpx;\n  height: 120rpx;\n  border-radius: 50%;\n  overflow: hidden;\n  border: 4rpx solid rgba(255, 255, 255, 0.3);\n}\n\n.avatar {\n  width: 100%;\n  height: 100%;\n}\n\n.user-info {\n  margin-left: 30rpx;\n  color: #fff;\n}\n\n.nickname {\n  font-size: 36rpx;\n  font-weight: 600;\n  margin-bottom: 10rpx;\n}\n\n.setting-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  min-height: 100rpx;\n  background: #fff;\n  transition: all 0.2s ease;\n  position: relative;\n  overflow: hidden;\n}\n\n.setting-item:active {\n  background: #f5f7fa;\n  transform: scale(0.98);\n}\n\n.setting-item::after {\n  content: '';\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.04);\n  border-radius: 20rpx;\n  transform: translate(-50%, -50%) scale(0);\n  opacity: 0;\n  transition: all 0.3s ease;\n}\n\n.setting-item:active::after {\n  transform: translate(-50%, -50%) scale(1);\n  opacity: 1;\n}\n\n.setting-item:active .logout {\n  opacity: 0.8;\n}\n\n.setting-left {\n  display: flex;\n  align-items: center;\n  gap: 20rpx;\n}\n\n.setting-icon {\n  font-size: 40rpx;\n}\n\n.setting-info {\n  display: flex;\n  flex-direction: column;\n  gap: 6rpx;\n}\n\n.setting-label {\n  font-size: 30rpx;\n  color: #2c3e50;\n}\n\n.setting-desc {\n  font-size: 24rpx;\n  color: #5c6b7a;\n}\n\n.arrow {\n  color: #5c6b7a;\n  font-size: 30rpx;\n}\n\n.picker-value {\n  color: #5c6b7a;\n  font-size: 30rpx;\n  display: flex;\n  align-items: center;\n  gap: 10rpx;\n}\n\n.logout .setting-label {\n  color: #ff3b30;\n}\n\n.qr-card-container {\n  position: fixed;\n  left: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0,0,0,.3);\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: opacity .3s ease;\n}\n\n.qr-card {\n  width: 85%;\n  max-width: 650rpx;\n  background: rgba(44,44,46,.8);\n  backdrop-filter: blur(20px);\n  border-radius: 32rpx;\n  border: 1px solid hsla(0,0%,100%,.15);\n  padding: 40rpx 30rpx;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  opacity: 0;\n  transform: translateY(100%);\n  box-shadow: 0 8rpx 32rpx rgba(0,0,0,.2);\n}\n\n.qr-date {\n  background: hsla(0,0%,100%,.1);\n  border-radius: 20rpx;\n  color: hsla(0,0%,100%,.7);\n  font-size: 24rpx;\n  font-weight: 500;\n  padding: 6rpx 16rpx;\n  position: absolute;\n  left: 24rpx;\n  top: 24rpx;\n}\n\n.qr-content {\n  margin: 60rpx 0 30rpx;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 30rpx;\n}\n\n.qr-title {\n  font-size: 36rpx;\n  font-weight: 600;\n  color: #ff9f0a;\n}\n\n.qr-image {\n  width: 400rpx;\n  height: 400rpx;\n  background: #fff;\n  border-radius: 20rpx;\n  padding: 20rpx;\n}\n\n.qr-desc {\n  font-size: 28rpx;\n  color: hsla(0,0%,100%,.9);\n  text-align: center;\n  line-height: 1.6;\n}\n\n.swipe-hint {\n  align-items: center;\n  animation: floatAnimation 2s ease-in-out infinite;\n  color: hsla(0,0%,100%,.6);\n  display: flex;\n  flex-direction: column;\n  margin-top: 20rpx;\n}\n\n.swipe-hint .hint-text {\n  font-size: 24rpx;\n  margin-bottom: 8rpx;\n}\n\n.swipe-hint .arrow-icon {\n  font-size: 32rpx;\n  opacity: .8;\n}\n\n.qr-card.slide-in {\n  animation: slideIn .5s cubic-bezier(.4,0,.2,1) forwards;\n}\n\n@keyframes slideIn {\n  0% {\n    opacity: 0;\n    transform: translateY(100%);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes floatAnimation {\n  0%, 100% {\n    transform: translateY(0);\n  }\n  50% {\n    transform: translateY(-10rpx);\n  }\n}\n\n/* 添加下滑相关样式 */\n.qr-card.slide-out-down {\n  animation: slideOutDown .5s cubic-bezier(.4,0,.2,1) forwards;\n}\n\n.qr-card.dragging {\n  transition: none;\n}\n\n@keyframes slideOutDown {\n  0% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n  100% {\n    opacity: 0;\n    transform: translateY(100%);\n  }\n}\n</style>\n","import MiniProgramPage from '/Users/linsir/Experiments/uni-app/habit-ai-uniapp/habit-ai-uniapp/pages/settings/settings.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","apiService"],"mappings":"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"}