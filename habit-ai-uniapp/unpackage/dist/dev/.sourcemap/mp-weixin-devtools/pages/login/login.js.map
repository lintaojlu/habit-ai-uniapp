{"version":3,"names":["_sfc_main","data","telephone","password","methods","goToRegister","common_vendor","index","navigateTo","url","handleSubmit","_this","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","res","userInfo","habitList","wrap","_callee$","_context","prev","next","showToast","title","icon","abrupt","showLoading","utils_api","apiService","login","sent","status","setStorageSync","token","getUserInfo","getHabitList","habits","map","habit","_objectSpread2","color","__f__","reLaunch","Error","message","t0","hideLoading","finish","stop","wx","createPage","MiniProgramPage"],"sources":["login.vue","login.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"logo-section\">\n      <image class=\"poster\" src=\"/static/poster.png\" mode=\"aspectFit\" />\n      <text class=\"app-name\">HabitAI</text>\n      <text class=\"slogan\">私人 AI，轻松养成好习惯</text>\n    </view>\n\n    <view class=\"form-section\">\n      <input \n        class=\"input-field\" \n        type=\"text\" \n        v-model=\"telephone\" \n        placeholder=\"手机号\"\n      />\n      <input \n        class=\"input-field\" \n        type=\"password\" \n        v-model=\"password\" \n        placeholder=\"密码\"\n      />\n      <button class=\"submit-button\" @tap=\"handleSubmit\">登录</button>\n      <text class=\"switch-mode\" @tap=\"goToRegister\">\n        没有账号？立即注册\n      </text>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { apiService } from '@/utils/api.js'\n\nexport default {\n  data() {\n    return {\n      telephone: '',\n      password: ''\n    }\n  },\n  methods: {\n    goToRegister() {\n      uni.navigateTo({\n        url: '/pages/register/register'\n      })\n    },\n    async handleSubmit() {\n      if (!this.telephone || !this.password) {\n        uni.showToast({\n          title: '请填写完整信息',\n          icon: 'none'\n        })\n        return\n      }\n      \n      uni.showLoading({\n        title: '登录中...'\n      })\n      \n      try {\n        const res = await apiService.login({\n          telephone: this.telephone,\n          password: this.password\n        })\n        \n        if (res.status === 'success') {\n          // 保存 token 和用户信息\n          uni.setStorageSync('token', res.token)\n          \n          // 获取用户详细信息\n          const userInfo = await apiService.getUserInfo()\n          if (userInfo.status === 'success') {\n            uni.setStorageSync('userInfo', userInfo.data)\n          }\n\n          // 获取习惯列表\n          const habitList = await apiService.getHabitList()\n          if (habitList.status === 'success') {\n              // 处理 habitList.data，确保每个习惯都有 icon 和 color\n              this.habits = habitList.data.map(habit => ({\n                  ...habit,\n                  icon: habit.icon || \"✨\",\n                  color: habit.color || '$theme-color'\n              }))\n              // 更新本地存储和数据\n              uni.setStorageSync('habits', habitList.data)\n              console.log(\"get habits from server\", habitList.data)\n          }\n          \n          uni.showToast({\n            title: '登录成功',\n            icon: 'success'\n          })\n          \n          // 跳转到首页\n          uni.reLaunch({\n            url: '/pages/index/index'\n          })\n        } else {\n          throw new Error(res.message || '登录失败')\n        }\n      } catch (error) {\n        uni.showToast({\n          title: error.message || '登录失败',\n          icon: 'none'\n        })\n      } finally {\n        uni.hideLoading()\n      }\n    }\n  }\n}\n</script>\n\n<style>\n.container {\n  padding: 40rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 100vh;\n  background-color: #fff;\n}\n\n.logo-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-bottom: 80rpx;\n}\n\n.poster {\n  width: 400rpx;\n  height: 400rpx;\n  margin-bottom: 30rpx;\n  border-radius: 50%;\n}\n\n.app-name {\n  font-size: 48rpx;\n  font-weight: bold;\n  color: #2c3e50;\n  margin-bottom: 20rpx;\n}\n\n.slogan {\n  font-size: 32rpx;\n  color: #5c6b7a;\n}\n\n.form-section {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: 30rpx;\n}\n\n.input-field {\n  width: 100%;\n  height: 100rpx;\n  background: #f5f7fa;\n  border-radius: 20rpx;\n  padding: 0 30rpx;\n  font-size: 32rpx;\n  color: #2c3e50;\n}\n\n.submit-button {\n  width: 100%;\n  height: 100rpx;\n  background: var(--theme-color);\n  border-radius: 20rpx;\n  color: #fff;\n  font-size: 32rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-top: 20rpx;\n}\n\n.submit-button:active {\n  opacity: 0.9;\n}\n\n.switch-mode {\n  text-align: center;\n  color: var(--theme-color);\n  font-size: 28rpx;\n  margin-top: 30rpx;\n}\n</style>","import MiniProgramPage from '/Users/linsir/Experiments/uni-app/habit-ai-uniapp/habit-ai-uniapp/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"mappings":";;;;;;;;;AAgCA,IAAKA,SAAA,GAAU;EACbC,IAAA,WAAAA,KAAA,EAAO;IACL,OAAO;MACLC,SAAA,EAAW;MACXC,QAAA,EAAU;IACZ;EACD;EACDC,OAAA,EAAS;IACPC,YAAA,WAAAA,aAAA,EAAe;MACbC,aAAA,CAAAC,KAAA,CAAIC,UAAA,CAAW;QACbC,GAAA,EAAK;MAAA,CACN;IACF;IACKC,YAAA,WAAAA,aAAA,EAAe;MAAA,IAAAC,KAAA;MAAA,OAAAC,kBAAA,eAAAC,oBAAA,GAAAC,IAAA,UAAAC,QAAA;QAAA,IAAAC,GAAA,EAAAC,QAAA,EAAAC,SAAA;QAAA,OAAAL,oBAAA,GAAAM,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAA,MACf,CAACZ,KAAA,CAAKT,SAAA,IAAa,CAACS,KAAA,CAAKR,QAAA;gBAAAkB,QAAA,CAAAE,IAAA;gBAAA;cAAA;cAC3BjB,aAAA,CAAAC,KAAA,CAAIiB,SAAA,CAAU;gBACZC,KAAA,EAAO;gBACPC,IAAA,EAAM;cAAA,CACP;cAAA,OAAAL,QAAA,CAAAM,MAAA;YAAA;cAIHrB,aAAA,CAAAC,KAAA,CAAIqB,WAAA,CAAY;gBACdH,KAAA,EAAO;cAAA,CACR;cAAAJ,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAE,IAAA;cAAA,OAGmBM,SAAA,CAAUC,UAAA,CAACC,KAAA,CAAM;gBACjC7B,SAAA,EAAWS,KAAA,CAAKT,SAAA;gBAChBC,QAAA,EAAUQ,KAAA,CAAKR;cAAA,CAChB;YAAA;cAHKa,GAAA,GAAAK,QAAA,CAAAW,IAAA;cAAA,MAKFhB,GAAA,CAAIiB,MAAA,KAAW;gBAAAZ,QAAA,CAAAE,IAAA;gBAAA;cAAA;cAEjBjB,aAAA,CAAAC,KAAA,CAAI2B,cAAA,CAAe,SAASlB,GAAA,CAAImB,KAAK;cAAAd,QAAA,CAAAE,IAAA;cAAA,OAGdM,SAAA,CAAUC,UAAA,CAACM,WAAA,EAAY;YAAA;cAAxCnB,QAAA,GAAAI,QAAA,CAAAW,IAAA;cACN,IAAIf,QAAA,CAASgB,MAAA,KAAW,WAAW;gBACjC3B,aAAA,CAAAC,KAAA,CAAI2B,cAAA,CAAe,YAAYjB,QAAA,CAAShB,IAAI;cAC9C;cAAAoB,QAAA,CAAAE,IAAA;cAAA,OAGwBM,SAAA,CAAUC,UAAA,CAACO,YAAA,EAAa;YAAA;cAA1CnB,SAAA,GAAAG,QAAA,CAAAW,IAAA;cACN,IAAId,SAAA,CAAUe,MAAA,KAAW,WAAW;gBAEhCtB,KAAA,CAAK2B,MAAA,GAASpB,SAAA,CAAUjB,IAAA,CAAKsC,GAAA,CAAI,UAAAC,KAAA;kBAAA,OAAAC,cAAA,CAAAA,cAAA,KAC1BD,KAAA;oBACHd,IAAA,EAAMc,KAAA,CAAMd,IAAA,IAAQ;oBACpBgB,KAAA,EAAOF,KAAA,CAAME,KAAA,IAAS;kBAAA;gBAAA,CACxB;gBAEFpC,aAAA,CAAAC,KAAA,CAAI2B,cAAA,CAAe,UAAUhB,SAAA,CAAUjB,IAAI;gBAC3CK,aAAA,CAAYC,KAAA,CAAAoC,KAAA,iEAA0BzB,SAAA,CAAUjB,IAAI;cACxD;cAEAK,aAAA,CAAAC,KAAA,CAAIiB,SAAA,CAAU;gBACZC,KAAA,EAAO;gBACPC,IAAA,EAAM;cAAA,CACP;cAGDpB,aAAA,CAAAC,KAAA,CAAIqC,QAAA,CAAS;gBACXnC,GAAA,EAAK;cAAA,CACN;cAAAY,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAA,MAEK,IAAIsB,KAAA,CAAM7B,GAAA,CAAI8B,OAAA,IAAW,MAAM;YAAA;cAAAzB,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAA0B,EAAA,GAAA1B,QAAA;cAGvCf,aAAA,CAAAC,KAAA,CAAIiB,SAAA,CAAU;gBACZC,KAAA,EAAOJ,QAAA,CAAA0B,EAAA,CAAMD,OAAA,IAAW;gBACxBpB,IAAA,EAAM;cAAA,CACP;YAAA;cAAAL,QAAA,CAAAC,IAAA;cAEDhB,aAAA,CAAAC,KAAA,CAAIyC,WAAA,EAAY;cAAA,OAAA3B,QAAA,CAAA4B,MAAA;YAAA;YAAA;cAAA,OAAA5B,QAAA,CAAA6B,IAAA;UAAA;QAAA,GAAAnC,OAAA;MAAA;IAEpB;EACF;AACF;;;;;;;;;;;;;;;;;;;;;AC7GAoC,EAAA,CAAGC,UAAA,CAAWC,eAAe","ignoreList":[]}